    public <%= entityClassName %> update() {
        return update(this);
    }

    public <%= entityClassName %> persistOrUpdate() {
        return persistOrUpdate(this);
    }

    public static <%= entityClassName %> update(<%= entityClassName %> <%= entityInstanceName %>) {
        if (<%= entityInstanceName %> == null) {
            throw new IllegalArgumentException("<%= entityInstanceName %> can't be null");
        }
        var entity = <%= entityClassName %>.<<%= entityClassName %>>findById(<%= entityInstanceName %>.id);
        if (entity != null) {
            <%_
            for (let idx = 0; idx < fields.length; idx++) {
                let fieldName = fields[idx].fieldName;
            _%>
            entity.<%= fieldName %> = <%= entityInstanceName %>.<%= fieldName %>;
            <%_ } _%>
            <%_
            for (let idx = 0; idx < relationships.length; idx++) {
                let relationship = relationships[idx]
                let fieldName = relationship.relationshipType.endsWith('to-many') ? relationship.relationshipFieldNamePlural : relationship.relationshipFieldName;
            _%>
            entity.<%= fieldName %> = <%= entityInstanceName %>.<%= fieldName %>;
            <%_ } _%>
        }
        return entity;
    }

    public static <%= entityClassName %> persistOrUpdate(<%= entityClassName %> <%= entityInstanceName %>) {
        if (<%= entityInstanceName %> == null) {
            throw new IllegalArgumentException("<%= entityInstanceName %> can't be null");
        }
        if (<%= entityInstanceName %>.id == null) {
            persist(<%= entityInstanceName %>);
            return <%= entityInstanceName %>;
        } else {
            return update(<%= entityInstanceName %>);
        }
    }
